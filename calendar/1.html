<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Calendar Clone</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
        }

        .calendar-container {
            max-width: 1200px;
            margin: 20px auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: #4285f4;
            color: white;
        }

        .calendar-title {
            font-size: 20px;
            font-weight: bold;
        }

        .calendar-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .calendar-view {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        button {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .active-view {
            background: rgba(255, 255, 255, 0.3);
        }

        .calendar-body {
            padding: 20px;
        }

        /* Month View */
        .month-view {
            display: none;
        }

        .month-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-weight: bold;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .month-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-auto-rows: 100px;
            gap: 5px;
        }

        .day-cell {
            border: 1px solid #eee;
            padding: 5px;
            overflow-y: auto;
        }

        .day-cell:hover {
            background-color: #f9f9f9;
        }

        .day-header {
            font-weight: bold;
            margin-bottom: 5px;
            text-align: right;
        }

        .current-day {
            background-color: #e6f2ff;
        }

        .other-month {
            color: #aaa;
            background-color: #f9f9f9;
        }

        .event {
            background-color: #e1f5fe;
            border-left: 3px solid #039be5;
            padding: 2px 5px;
            margin-bottom: 3px;
            border-radius: 3px;
            font-size: 12px;
            cursor: pointer;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .event:hover {
            opacity: 0.9;
        }

        /* Week View */
        .week-view {
            display: none;
        }

        .week-header {
            display: grid;
            grid-template-columns: 50px repeat(7, 1fr);
            text-align: center;
            font-weight: bold;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .week-days {
            display: grid;
            grid-template-columns: 50px repeat(7, 1fr);
            grid-auto-rows: 30px;
            gap: 2px;
        }

        .time-slot {
            border-right: 1px solid #eee;
            text-align: right;
            padding-right: 5px;
            font-size: 12px;
            color: #666;
        }

        .week-day {
            border: 1px solid #eee;
            position: relative;
        }

        .week-day-header {
            font-weight: bold;
            padding: 2px 5px;
            border-bottom: 1px solid #eee;
        }

        .week-event {
            position: absolute;
            background-color: #e1f5fe;
            border-left: 3px solid #039be5;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 12px;
            cursor: pointer;
            overflow: hidden;
            z-index: 1;
        }

        /* Day View */
        .day-view {
            display: none;
        }

        .day-header {
            text-align: center;
            font-weight: bold;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .day-hours {
            display: grid;
            grid-template-columns: 50px 1fr;
            grid-auto-rows: 60px;
            gap: 2px;
        }

        .day-hour {
            border-right: 1px solid #eee;
            text-align: right;
            padding-right: 5px;
            font-size: 12px;
            color: #666;
        }

        .day-slot {
            border: 1px solid #eee;
            position: relative;
        }

        .day-event {
            position: absolute;
            background-color: #e1f5fe;
            border-left: 3px solid #039be5;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 12px;
            cursor: pointer;
            overflow: hidden;
            width: 100%;
            z-index: 1;
        }

        /* Year View */
        .year-view {
            display: none;
        }

        .year-months {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        .year-month {
            border: 1px solid #eee;
            padding: 10px;
        }

        .year-month-title {
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .year-month-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }

        .year-day-header {
            font-size: 10px;
            text-align: center;
            color: #666;
        }

        .year-day {
            font-size: 10px;
            text-align: center;
            padding: 2px;
        }

        .year-current-day {
            background-color: #4285f4;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: inline-block;
            line-height: 18px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            width: 400px;
            max-width: 90%;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-primary {
            background-color: #4285f4;
            color: white;
            border: none;
        }

        .btn-secondary {
            background-color: #f1f1f1;
            color: #333;
            border: none;
        }

        .btn-danger {
            background-color: #dc3545;
            color: white;
            border: none;
        }

        /* Active view */
        .active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="calendar-container">
        <div class="calendar-header">
            <div class="calendar-title" id="calendar-title">Calendar</div>
            <div class="calendar-controls">
                <div class="calendar-nav">
                    <button id="prev-btn">&lt;</button>
                    <button id="today-btn">Today</button>
                    <button id="next-btn">&gt;</button>
                </div>
                <div class="calendar-view">
                    <button id="day-view-btn" class="active-view">Day</button>
                    <button id="week-view-btn">Week</button>
                    <button id="month-view-btn">Month</button>
                    <button id="year-view-btn">Year</button>
                </div>
            </div>
        </div>

        <div class="calendar-body">
            <!-- Month View -->
            <div class="month-view" id="month-view">
                <div class="month-header">
                    <div>Sun</div>
                    <div>Mon</div>
                    <div>Tue</div>
                    <div>Wed</div>
                    <div>Thu</div>
                    <div>Fri</div>
                    <div>Sat</div>
                </div>
                <div class="month-days" id="month-days"></div>
            </div>

            <!-- Week View -->
            <div class="week-view" id="week-view">
                <div class="week-header">
                    <div></div>
                    <div id="week-day-0">Sun</div>
                    <div id="week-day-1">Mon</div>
                    <div id="week-day-2">Tue</div>
                    <div id="week-day-3">Wed</div>
                    <div id="week-day-4">Thu</div>
                    <div id="week-day-5">Fri</div>
                    <div id="week-day-6">Sat</div>
                </div>
                <div class="week-days" id="week-days"></div>
            </div>

            <!-- Day View -->
            <div class="day-view active" id="day-view">
                <div class="day-header" id="day-header">Day</div>
                <div class="day-hours" id="day-hours"></div>
            </div>

            <!-- Year View -->
            <div class="year-view" id="year-view">
                <div class="year-months" id="year-months"></div>
            </div>
        </div>
    </div>

    <!-- Event Modal -->
    <div class="modal" id="event-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modal-title">Add Event</div>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            <form id="event-form">
                <input type="hidden" id="event-id">
                <div class="form-group">
                    <label for="event-title">Title</label>
                    <input type="text" id="event-title" required>
                </div>
                <div class="form-group">
                    <label for="event-user">User</label>
                    <input type="text" id="event-user" required>
                </div>
                <div class="form-group">
                    <label for="event-date">Date</label>
                    <input type="date" id="event-date" required>
                </div>
                <div class="form-group">
                    <label for="event-start-time">Start Time</label>
                    <input type="time" id="event-start-time" required>
                </div>
                <div class="form-group">
                    <label for="event-end-time">End Time</label>
                    <input type="time" id="event-end-time" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-btn">Cancel</button>
                    <button type="button" class="btn btn-danger" id="delete-btn" style="display: none;">Delete</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const calendarTitle = document.getElementById('calendar-title');
            const prevBtn = document.getElementById('prev-btn');
            const todayBtn = document.getElementById('today-btn');
            const nextBtn = document.getElementById('next-btn');
            const dayViewBtn = document.getElementById('day-view-btn');
            const weekViewBtn = document.getElementById('week-view-btn');
            const monthViewBtn = document.getElementById('month-view-btn');
            const yearViewBtn = document.getElementById('year-view-btn');
            const monthView = document.getElementById('month-view');
            const weekView = document.getElementById('week-view');
            const dayView = document.getElementById('day-view');
            const yearView = document.getElementById('year-view');
            const monthDays = document.getElementById('month-days');
            const weekDays = document.getElementById('week-days');
            const dayHours = document.getElementById('day-hours');
            const yearMonths = document.getElementById('year-months');
            const eventModal = document.getElementById('event-modal');
            const closeModal = document.getElementById('close-modal');
            const cancelBtn = document.getElementById('cancel-btn');
            const deleteBtn = document.getElementById('delete-btn');
            const eventForm = document.getElementById('event-form');
            const modalTitle = document.getElementById('modal-title');
            const eventIdInput = document.getElementById('event-id');
            const eventTitleInput = document.getElementById('event-title');
            const eventUserInput = document.getElementById('event-user');
            const eventDateInput = document.getElementById('event-date');
            const eventStartTimeInput = document.getElementById('event-start-time');
            const eventEndTimeInput = document.getElementById('event-end-time');

            // Calendar state
            let currentDate = new Date();
            let currentView = 'day';
            let events = JSON.parse(localStorage.getItem('calendarEvents')) || [];

            // Initialize calendar
            function initCalendar() {
                updateCalendarTitle();
                renderMonthView();
                renderWeekView();
                renderDayView();
                renderYearView();
                setActiveView(currentView);
            }

            // Update calendar title based on current view and date
            function updateCalendarTitle() {
                const options = { year: 'numeric', month: 'long' };
                
                switch(currentView) {
                    case 'day':
                        calendarTitle.textContent = currentDate.toLocaleDateString('en-US', { 
                            weekday: 'long', 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric' 
                        });
                        break;
                    case 'week':
                        const weekStart = new Date(currentDate);
                        weekStart.setDate(currentDate.getDate() - currentDate.getDay());
                        const weekEnd = new Date(weekStart);
                        weekEnd.setDate(weekStart.getDate() + 6);
                        
                        if (weekStart.getMonth() === weekEnd.getMonth()) {
                            calendarTitle.textContent = 
                                weekStart.toLocaleDateString('en-US', { month: 'long' }) + ' ' +
                                weekStart.getDate() + '-' + weekEnd.getDate() + ', ' +
                                weekStart.getFullYear();
                        } else if (weekStart.getFullYear() === weekEnd.getFullYear()) {
                            calendarTitle.textContent = 
                                weekStart.toLocaleDateString('en-US', { month: 'short' }) + ' ' +
                                weekStart.getDate() + ' - ' +
                                weekEnd.toLocaleDateString('en-US', { month: 'short' }) + ' ' +
                                weekEnd.getDate() + ', ' +
                                weekStart.getFullYear();
                        } else {
                            calendarTitle.textContent = 
                                weekStart.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }) + ' - ' +
                                weekEnd.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                        }
                        break;
                    case 'month':
                        calendarTitle.textContent = currentDate.toLocaleDateString('en-US', { 
                            month: 'long', 
                            year: 'numeric' 
                        });
                        break;
                    case 'year':
                        calendarTitle.textContent = currentDate.getFullYear();
                        break;
                }
            }

            // Set active view
            function setActiveView(view) {
                currentView = view;
                
                // Hide all views
                monthView.classList.remove('active');
                weekView.classList.remove('active');
                dayView.classList.remove('active');
                yearView.classList.remove('active');
                
                // Remove active class from all view buttons
                dayViewBtn.classList.remove('active-view');
                weekViewBtn.classList.remove('active-view');
                monthViewBtn.classList.remove('active-view');
                yearViewBtn.classList.remove('active-view');
                
                // Show selected view and add active class to button
                switch(view) {
                    case 'month':
                        monthView.classList.add('active');
                        monthViewBtn.classList.add('active-view');
                        renderMonthView();
                        break;
                    case 'week':
                        weekView.classList.add('active');
                        weekViewBtn.classList.add('active-view');
                        renderWeekView();
                        break;
                    case 'day':
                        dayView.classList.add('active');
                        dayViewBtn.classList.add('active-view');
                        renderDayView();
                        break;
                    case 'year':
                        yearView.classList.add('active');
                        yearViewBtn.classList.add('active-view');
                        renderYearView();
                        break;
                }
                
                updateCalendarTitle();
            }

            // Render month view
            function renderMonthView() {
                monthDays.innerHTML = '';
                
                const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
                const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
                
                const startDay = firstDay.getDay();
                const daysInMonth = lastDay.getDate();
                const daysInPrevMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0).getDate();
                
                // Previous month days
                for (let i = startDay - 1; i >= 0; i--) {
                    const day = daysInPrevMonth - i;
                    const date = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, day);
                    createDayCell(day, date, true);
                }
                
                // Current month days
                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                    createDayCell(day, date, false);
                }
                
                // Next month days
                const totalCells = Math.ceil((startDay + daysInMonth) / 7) * 7;
                const nextMonthDays = totalCells - (startDay + daysInMonth);
                
                for (let day = 1; day <= nextMonthDays; day++) {
                    const date = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, day);
                    createDayCell(day, date, true);
                }
            }

            // Create day cell for month view
            function createDayCell(day, date, isOtherMonth) {
                const dayCell = document.createElement('div');
                dayCell.className = 'day-cell';
                
                if (isOtherMonth) {
                    dayCell.classList.add('other-month');
                }
                
                // Highlight current day
                const today = new Date();
                if (date.getDate() === today.getDate() && 
                    date.getMonth() === today.getMonth() && 
                    date.getFullYear() === today.getFullYear()) {
                    dayCell.classList.add('current-day');
                }
                
                const dayHeader = document.createElement('div');
                dayHeader.className = 'day-header';
                dayHeader.textContent = day;
                dayCell.appendChild(dayHeader);
                
                // Add events to the day
                const dayEvents = getEventsForDate(date);
                dayEvents.forEach(event => {
                    const eventElement = document.createElement('div');
                    eventElement.className = 'event';
                    eventElement.textContent = `${event.user}: ${event.title}`;
                    eventElement.dataset.id = event.id;
                    eventElement.addEventListener('click', () => openEditModal(event));
                    dayCell.appendChild(eventElement);
                });
                
                // Add click event to create new event
                dayCell.addEventListener('click', (e) => {
                  if (e.target === dayCell || e.target === dayHeader) {
                      console.log('e: ', e);
                        openAddModal(date);
                    }
                });
                
                monthDays.appendChild(dayCell);
            }

            // Render week view
            function renderWeekView() {
                weekDays.innerHTML = '';
                
                const weekStart = new Date(currentDate);
                weekStart.setDate(currentDate.getDate() - currentDate.getDay());
                
                // Update day headers
                for (let i = 0; i < 7; i++) {
                    const day = new Date(weekStart);
                    day.setDate(weekStart.getDate() + i);
                    
                    const dayElement = document.getElementById(`week-day-${i}`);
                    dayElement.textContent = day.toLocaleDateString('en-US', { 
                        weekday: 'short', 
                        month: 'short', 
                        day: 'numeric' 
                    });
                }
                
                // Create time slots
                for (let hour = 0; hour < 24; hour++) {
                    const timeSlot = document.createElement('div');
                    timeSlot.className = 'time-slot';
                    timeSlot.textContent = formatHour(hour);
                    weekDays.appendChild(timeSlot);
                    
                    for (let i = 0; i < 7; i++) {
                        const day = new Date(weekStart);
                        day.setDate(weekStart.getDate() + i);
                        day.setHours(hour, 0, 0, 0);
                        
                        const daySlot = document.createElement('div');
                        daySlot.className = 'week-day';
                        daySlot.dataset.date = day.toISOString();
                        
                        // Highlight current time
                        const now = new Date();
                        if (day.getDate() === now.getDate() && 
                            day.getMonth() === now.getMonth() && 
                            day.getFullYear() === now.getFullYear() && 
                            hour === now.getHours()) {
                            daySlot.style.backgroundColor = '#e6f2ff';
                        }
                        
                        // Add events to the time slot
                        const slotStart = new Date(day);
                        const slotEnd = new Date(day);
                        slotEnd.setHours(hour + 1, 0, 0, 0);
                        
                        const slotEvents = getEventsForTimeRange(slotStart, slotEnd);
                        slotEvents.forEach(event => {
                            const eventStart = new Date(event.start);
                            const eventEnd = new Date(event.end);
                            const top = (eventStart.getMinutes() / 60) * 100;
                            const height = ((eventEnd - eventStart) / (1000 * 60 * 60)) * 100;
                            
                            const eventElement = document.createElement('div');
                            eventElement.className = 'week-event';
                            eventElement.textContent = `${event.user}: ${event.title}`;
                            eventElement.style.top = `${top}%`;
                            eventElement.style.height = `${height}%`;
                            eventElement.dataset.id = event.id;
                            eventElement.addEventListener('click', () => openEditModal(event));
                            daySlot.appendChild(eventElement);
                        });
                        
                        // Add click event to create new event
                        daySlot.addEventListener('click', (e) => {
                            if (e.target === daySlot) {
                                const clickedTime = new Date(daySlot.dataset.date);
                                console.log('clickedTime: ', clickedTime);
                                openAddModal(clickedTime);
                            }
                        });
                        
                        weekDays.appendChild(daySlot);
                    }
                }
            }

            // Render day view
            function renderDayView() {
                dayHours.innerHTML = '';
                
                const dayHeader = document.getElementById('day-header');
                dayHeader.textContent = currentDate.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                // Create time slots
                for (let hour = 0; hour < 24; hour++) {
                    const timeSlot = document.createElement('div');
                    timeSlot.className = 'day-hour';
                    timeSlot.textContent = formatHour(hour);
                    dayHours.appendChild(timeSlot);
                    
                    const hourSlot = document.createElement('div');
                    hourSlot.className = 'day-slot';
                    
                    const slotTime = new Date(currentDate);
                    slotTime.setHours(hour, 0, 0, 0);
                    hourSlot.dataset.date = slotTime.toISOString();
                    
                    // Highlight current time
                    const now = new Date();
                    if (currentDate.getDate() === now.getDate() && 
                        currentDate.getMonth() === now.getMonth() && 
                        currentDate.getFullYear() === now.getFullYear() && 
                        hour === now.getHours()) {
                        hourSlot.style.backgroundColor = '#e6f2ff';
                    }
                    
                    // Add events to the time slot
                    const slotStart = new Date(slotTime);
                    const slotEnd = new Date(slotTime);
                    slotEnd.setHours(hour + 1, 0, 0, 0);
                    
                    const slotEvents = getEventsForTimeRange(slotStart, slotEnd);
                    slotEvents.forEach(event => {
                        const eventStart = new Date(event.start);
                        const eventEnd = new Date(event.end);
                        const top = (eventStart.getMinutes() / 60) * 100;
                        const height = ((eventEnd - eventStart) / (1000 * 60 * 60)) * 100;
                        
                        const eventElement = document.createElement('div');
                        eventElement.className = 'day-event';
                        eventElement.textContent = `${event.user}: ${event.title}`;
                        eventElement.style.top = `${top}%`;
                        eventElement.style.height = `${height}%`;
                        eventElement.dataset.id = event.id;
                        eventElement.addEventListener('click', () => openEditModal(event));
                        hourSlot.appendChild(eventElement);
                    });
                    
                    // Add click event to create new event
                    hourSlot.addEventListener('click', (e) => {
                      console.log('e: ', e);
                        if (e.target === hourSlot) {
                            const clickedTime = new Date(hourSlot.dataset.date);
                            openAddModal(clickedTime);
                        }
                    });
                    
                    dayHours.appendChild(hourSlot);
                }
            }

            // Render year view
            function renderYearView() {
                yearMonths.innerHTML = '';
                
                for (let month = 0; month < 12; month++) {
                    const monthContainer = document.createElement('div');
                    monthContainer.className = 'year-month';
                    
                    const monthTitle = document.createElement('div');
                    monthTitle.className = 'year-month-title';
                    monthTitle.textContent = new Date(currentDate.getFullYear(), month, 1).toLocaleDateString('en-US', { month: 'long' });
                    monthContainer.appendChild(monthTitle);
                    
                    const daysContainer = document.createElement('div');
                    daysContainer.className = 'year-month-days';
                    
                    // Add day headers
                    for (let i = 0; i < 7; i++) {
                        const dayHeader = document.createElement('div');
                        dayHeader.className = 'year-day-header';
                        dayHeader.textContent = ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'][i];
                        daysContainer.appendChild(dayHeader);
                    }
                    
                    const firstDay = new Date(currentDate.getFullYear(), month, 1);
                    const lastDay = new Date(currentDate.getFullYear(), month + 1, 0);
                    const startDay = firstDay.getDay();
                    const daysInMonth = lastDay.getDate();
                    
                    // Add empty cells for days before the first day of the month
                    for (let i = 0; i < startDay; i++) {
                        const emptyCell = document.createElement('div');
                        emptyCell.className = 'year-day';
                        daysContainer.appendChild(emptyCell);
                    }
                    
                    // Add days of the month
                    for (let day = 1; day <= daysInMonth; day++) {
                        const dayCell = document.createElement('div');
                        dayCell.className = 'year-day';
                        
                        const today = new Date();
                        if (day === today.getDate() && 
                            month === today.getMonth() && 
                            currentDate.getFullYear() === today.getFullYear()) {
                            dayCell.innerHTML = `<span class="year-current-day">${day}</span>`;
                        } else {
                            dayCell.textContent = day;
                        }
                        
                        const date = new Date(currentDate.getFullYear(), month, day);
                        dayCell.addEventListener('click', () => {
                            currentDate = date;
                            setActiveView('day');
                        });
                        
                        daysContainer.appendChild(dayCell);
                    }
                    
                    monthContainer.appendChild(daysContainer);
                    yearMonths.appendChild(monthContainer);
                }
            }

            // Format hour for display
            function formatHour(hour) {
                return hour === 0 ? '12 AM' : 
                       hour < 12 ? `${hour} AM` : 
                       hour === 12 ? '12 PM' : 
                       `${hour - 12} PM`;
            }

            // Get events for a specific date
            function getEventsForDate(date) {
                const start = new Date(date);
                start.setHours(0, 0, 0, 0);
                
                const end = new Date(date);
                end.setHours(23, 59, 59, 999);
                
                return getEventsForTimeRange(start, end);
            }

            // Get events for a time range
            function getEventsForTimeRange(start, end) {
                return events.filter(event => {
                    const eventStart = new Date(event.start);
                    const eventEnd = new Date(event.end);
                    return (eventStart >= start && eventStart < end) || 
                           (eventEnd > start && eventEnd <= end) || 
                           (eventStart <= start && eventEnd >= end);
                });
            }

            // Open modal to add new event
            function openAddModal(date) {
                modalTitle.textContent = 'Add Event';
                eventIdInput.value = '';
                eventTitleInput.value = '';
                eventUserInput.value = '';
                
                const dateStr = date.toISOString().split('T')[0];
                const timeStr = date.toTimeString().substring(0, 5);
                
                eventDateInput.value = dateStr;
                eventStartTimeInput.value = timeStr;
                
                // Set end time to 1 hour later by default
                const endTime = new Date(date);
                endTime.setHours(date.getHours() + 1);
                eventEndTimeInput.value = endTime.toTimeString().substring(0, 5);
                
                deleteBtn.style.display = 'none';
                eventModal.style.display = 'flex';
            }

            // Open modal to edit existing event
            function openEditModal(event) {
                modalTitle.textContent = 'Edit Event';
                eventIdInput.value = event.id;
                eventTitleInput.value = event.title;
                eventUserInput.value = event.user;
                
                const startDate = new Date(event.start);
                const endDate = new Date(event.end);
                
                eventDateInput.value = startDate.toISOString().split('T')[0];
                eventStartTimeInput.value = startDate.toTimeString().substring(0, 5);
                eventEndTimeInput.value = endDate.toTimeString().substring(0, 5);
                
                deleteBtn.style.display = 'block';
                eventModal.style.display = 'flex';
            }

            // Save event
            function saveEvent(eventData) {
                if (eventData.id) {
                    // Update existing event
                    const index = events.findIndex(e => e.id === eventData.id);
                    if (index !== -1) {
                        events[index] = eventData;
                    }
                } else {
                    // Add new event
                    eventData.id = generateId();
                    events.push(eventData);
                }
                
                // Sort events by start time
                events.sort((a, b) => new Date(a.start) - new Date(b.start));
                
                // Save to localStorage
                localStorage.setItem('calendarEvents', JSON.stringify(events));
                
                // Refresh views
                renderMonthView();
                renderWeekView();
                renderDayView();
            }

            // Delete event
            function deleteEvent(eventId) {
                events = events.filter(event => event.id !== eventId);
                localStorage.setItem('calendarEvents', JSON.stringify(events));
                
                // Refresh views
                renderMonthView();
                renderWeekView();
                renderDayView();
            }

            // Generate unique ID for events
            function generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }

            // Navigate to previous period
            function navigatePrevious() {
                switch(currentView) {
                    case 'day':
                        currentDate.setDate(currentDate.getDate() - 1);
                        break;
                    case 'week':
                        currentDate.setDate(currentDate.getDate() - 7);
                        break;
                    case 'month':
                        currentDate.setMonth(currentDate.getMonth() - 1);
                        break;
                    case 'year':
                        currentDate.setFullYear(currentDate.getFullYear() - 1);
                        break;
                }
                
                updateCalendarTitle();
                
                if (currentView === 'month') renderMonthView();
                else if (currentView === 'week') renderWeekView();
                else if (currentView === 'day') renderDayView();
                else if (currentView === 'year') renderYearView();
            }

            // Navigate to next period
            function navigateNext() {
                switch(currentView) {
                    case 'day':
                        currentDate.setDate(currentDate.getDate() + 1);
                        break;
                    case 'week':
                        currentDate.setDate(currentDate.getDate() + 7);
                        break;
                    case 'month':
                        currentDate.setMonth(currentDate.getMonth() + 1);
                        break;
                    case 'year':
                        currentDate.setFullYear(currentDate.getFullYear() + 1);
                        break;
                }
                
                updateCalendarTitle();
                
                if (currentView === 'month') renderMonthView();
                else if (currentView === 'week') renderWeekView();
                else if (currentView === 'day') renderDayView();
                else if (currentView === 'year') renderYearView();
            }

            // Navigate to today
            function navigateToday() {
                currentDate = new Date();
                updateCalendarTitle();
                
                if (currentView === 'month') renderMonthView();
                else if (currentView === 'week') renderWeekView();
                else if (currentView === 'day') renderDayView();
                else if (currentView === 'year') renderYearView();
            }

            // Event listeners
            prevBtn.addEventListener('click', navigatePrevious);
            nextBtn.addEventListener('click', navigateNext);
            todayBtn.addEventListener('click', navigateToday);
            
            dayViewBtn.addEventListener('click', () => setActiveView('day'));
            weekViewBtn.addEventListener('click', () => setActiveView('week'));
            monthViewBtn.addEventListener('click', () => setActiveView('month'));
            yearViewBtn.addEventListener('click', () => setActiveView('year'));
            
            closeModal.addEventListener('click', () => eventModal.style.display = 'none');
            cancelBtn.addEventListener('click', () => eventModal.style.display = 'none');
            
            deleteBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to delete this event?')) {
                    deleteEvent(eventIdInput.value);
                    eventModal.style.display = 'none';
                }
            });
            
            eventForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const startDateTime = new Date(`${eventDateInput.value}T${eventStartTimeInput.value}`);
                const endDateTime = new Date(`${eventDateInput.value}T${eventEndTimeInput.value}`);
                
                if (endDateTime <= startDateTime) {
                    alert('End time must be after start time');
                    return;
                }
                
                const eventData = {
                    id: eventIdInput.value,
                    title: eventTitleInput.value,
                    user: eventUserInput.value,
                    start: startDateTime.toISOString(),
                    end: endDateTime.toISOString()
                };
                
                saveEvent(eventData);
                eventModal.style.display = 'none';
            });

            // Initialize calendar
            initCalendar();
        });
    </script>
</body>
</html>