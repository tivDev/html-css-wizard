<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Custom DateTime Picker</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f0f3f7;
      height: 100vh;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding-top: 80px;
    }

    .datetime-picker-container {
      position: relative;
      width: 320px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.12);
      padding: 20px;
    }

    label {
      font-weight: 600;
      color: #333;
      display: block;
      margin-bottom: 8px;
    }

    input[type="text"] {
      width: 90%;
      padding: 10px 14px;
      font-size: 16px;
      border: 1.8px solid #ccc;
      border-radius: 8px;
      cursor: pointer;
    }

    input[type="text"]:focus {
      border-color: #007bff;
      outline: none;
    }

    .popup {
      position: absolute;
      top: 60px;
      left: 0;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.15);
      padding: 16px;
      display: none;
      z-index: 100;
    }

    /* Calendar styles */
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .calendar-header button {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: #007bff;
      padding: 4px 8px;
      border-radius: 6px;
      transition: background-color 0.2s ease;
    }

    .calendar-header button:hover {
      background-color: #e1f0ff;
    }

    .calendar-month {
      font-weight: 700;
      font-size: 18px;
      color: #333;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      margin-bottom: 16px;
    }

    .calendar-day-name {
      font-weight: 600;
      font-size: 13px;
      color: #666;
      text-align: center;
    }

    .calendar-day {
      width: 38px;
      height: 38px;
      line-height: 38px;
      text-align: center;
      border-radius: 8px;
      cursor: pointer;
      user-select: none;
      color: #444;
      transition: background-color 0.2s ease;
    }

    .calendar-day:hover {
      background-color: #e1f0ff;
    }

    .calendar-day.inactive {
      color: #bbb;
      cursor: default;
    }

    .calendar-day.selected {
      background-color: #007bff;
      color: white;
      font-weight: 700;
    }

    /* Time picker styles */
    .time-picker {
      display: flex;
      gap: 12px;
      flex-direction: column;
    }

    input[type="range"]:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 0 2px rgba(51, 153, 255, 0.25);
      border-radius: 100px;
    }

    .time-value-display {
      min-width: 60px;
      text-align: center;
      font-size: 16px;
      color: #444;
      margin-left: 8px;
    }

    .today-btn {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .today-btn:hover {
      background-color: #0056b3;
    }

    .month-year-picker {
      display: flex;
      width: 300px;
      padding: 10px 0px 10px 0px;
    }

    select {
      flex: 1;
      margin: 0 5px;
      padding: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <div class="datetime-picker-container">
    <label for="datetimeInput">Select Date & Time</label>
    <input type="text" id="datetimeInput" input-type="dateTime" placeholder="YYYY-MM-DD HH:mm:ss" readonly />

  </div>
  <div class="datetime-picker-container">
    <label for="datetimeInput">Select Date</label>
    <input type="text" id="datetimeInput" input-type="date" placeholder="YYYY-MM-DD" readonly />

  </div>
  <script>
    class DateTimePicker {
      constructor(inputSelector) {
        this.input = document.querySelector(inputSelector);

        // Prevent multiple pickers on same input
        if (!this.input || this.input.dataset.pickerAttached === 'true') return;
        this.input.dataset.pickerAttached = 'true';

        this.inputType = this.input.getAttribute('input-type'); // date or dateTime
        this.selectedDate = new Date();
        this.viewYear = this.selectedDate.getFullYear();
        this.viewMonth = this.selectedDate.getMonth();

        this.initPopup();
        this.bindEvents();
      }

      initPopup() {
        // Remove previous popup if it exists
        if (this.input._popup) {
          this.input._popup.remove();
        }

        this.popup = document.createElement('div');
        this.popup.className = 'datetime-picker-popup popup';
        this.popup.style.position = 'absolute';
        this.popup.style.display = 'none';
        this.popup.style.zIndex = '9999';

        this.popup.innerHTML = `
      <div class="calendar-header">
        <button title="Previous month" class="prev-month">&#8592;</button>
        <div class="calendar-month month-year"></div>
        <button title="Next month" class="next-month">&#8594;</button>
      </div>
      <div class="calendar-grid">
        ${['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
            .map(day => `<div class="calendar-day-name">${day}</div>`).join('')}
      </div>
      ${this.inputType === 'dateTime' ? `
      <div class="time-picker">
        <div class="time-picker-row">
          <input type="range" class="hour" min="0" max="23"><span class="hour-val">00</span>
        </div>
        <div class="time-picker-row">
          <input type="range" class="minute" min="0" max="59"><span class="minute-val">00</span>
        </div>
        <div class="time-picker-row">
          <input type="range" class="second" min="0" max="59"><span class="second-val">00</span>
        </div>
      </div>` : ''}
      <button class="today-btn">Today</button>
    `;

        document.body.appendChild(this.popup);
        this.input._popup = this.popup;

        // Cache DOM elements
        this.grid = this.popup.querySelector('.calendar-grid');
        this.monthYear = this.popup.querySelector('.month-year');

        if (this.inputType === 'dateTime') {
          this.hour = this.popup.querySelector('.hour');
          this.minute = this.popup.querySelector('.minute');
          this.second = this.popup.querySelector('.second');
          this.hourVal = this.popup.querySelector('.hour-val');
          this.minuteVal = this.popup.querySelector('.minute-val');
          this.secondVal = this.popup.querySelector('.second-val');
        }
      }

      bindEvents() {
        this.input.addEventListener('click', () => this.openPopup());

        this.popup.querySelector('.prev-month').addEventListener('click', () => {
          this.viewMonth--;
          if (this.viewMonth < 0) {
            this.viewMonth = 11;
            this.viewYear--;
          }
          this.renderCalendar();
        });

        this.popup.querySelector('.next-month').addEventListener('click', () => {
          this.viewMonth++;
          if (this.viewMonth > 11) {
            this.viewMonth = 0;
            this.viewYear++;
          }
          this.renderCalendar();
        });

        this.popup.querySelector('.today-btn').addEventListener('click', () => {
          this.selectedDate = new Date();
          if (this.hour) this.hour.value = this.selectedDate.getHours();
          if (this.minute) this.minute.value = this.selectedDate.getMinutes();
          if (this.second) this.second.value = this.selectedDate.getSeconds();
          this.updateTimeDisplay();
          this.setInputValue();
          this.closePopup();
        });

        this.monthYear.addEventListener('click', () => this.toggleMonthYearPicker());

        if (this.hour) this.hour.addEventListener('input', () => this.updateTimeDisplay());
        if (this.minute) this.minute.addEventListener('input', () => this.updateTimeDisplay());
        if (this.second) this.second.addEventListener('input', () => this.updateTimeDisplay());

        // Hide popup on outside click
        document.addEventListener('click', (e) => {
          if (!this.popup.contains(e.target) && e.target !== this.input) {
            this.closePopup();
          }
        });

        window.addEventListener('resize', () => this.closePopup());
      }

      updateTimeDisplay() {
        if (!this.hour || !this.minute || !this.second) return;

        this.hourVal.textContent = this.hour.value.padStart(2, '0');
        this.minuteVal.textContent = this.minute.value.padStart(2, '0');
        this.secondVal.textContent = this.second.value.padStart(2, '0');
      }

      renderCalendar() {
        // Clear previous days (keep day names)
        while (this.grid.children.length > 7) {
          this.grid.removeChild(this.grid.lastChild);
        }

        const daysInMonth = new Date(this.viewYear, this.viewMonth + 1, 0).getDate();
        const firstDay = new Date(this.viewYear, this.viewMonth, 1).getDay();

        this.monthYear.textContent = `${new Date(this.viewYear, this.viewMonth).toLocaleString('default', { month: 'long' })} ${this.viewYear}`;

        // Add blank days for alignment
        for (let i = 0; i < firstDay; i++) {
          const blank = document.createElement('div');
          blank.className = 'calendar-day inactive';
          this.grid.appendChild(blank);
        }

        // Add days of the month
        for (let d = 1; d <= daysInMonth; d++) {
          const dayDiv = document.createElement('div');
          dayDiv.className = 'calendar-day';
          dayDiv.textContent = d;

          if (d === this.selectedDate.getDate() &&
            this.viewMonth === this.selectedDate.getMonth() &&
            this.viewYear === this.selectedDate.getFullYear()) {
            dayDiv.classList.add('selected');
          }

          dayDiv.addEventListener('click', () => {
            this.selectedDate = new Date(
              this.viewYear,
              this.viewMonth,
              d,
              this.hour ? this.hour.value : 0,
              this.minute ? this.minute.value : 0,
              this.second ? this.second.value : 0
            );
            this.setInputValue();
            this.closePopup();
          });

          this.grid.appendChild(dayDiv);
        }
      }

      setInputValue() {
        this.input.value = this.inputType === 'date'
          ? this.selectedDate.toISOString().substring(0, 10)
          : this.selectedDate.toISOString().replace('T', ' ').substring(0, 19);
      }

      openPopup() {
        const rect = this.input.getBoundingClientRect();
        const scrollTop = window.scrollY;
        const scrollLeft = window.scrollX;

        let top = scrollTop + rect.bottom;
        let left = scrollLeft + rect.left;

        this.popup.style.display = 'block';

        const popupRect = this.popup.getBoundingClientRect();
        const popupWidth = popupRect.width;
        const popupHeight = popupRect.height;
        const viewportWidth = window.innerWidth;
        const viewportHeight = window.innerHeight;

        if (left + popupWidth > scrollLeft + viewportWidth) {
          left = scrollLeft + viewportWidth - popupWidth - 10;
          if (left < scrollLeft) left = scrollLeft;
        }

        if (top + popupHeight > scrollTop + viewportHeight) {
          const aboveTop = scrollTop + rect.top - popupHeight;
          if (aboveTop > scrollTop) {
            top = aboveTop;
          } else {
            top = scrollTop + viewportHeight - popupHeight - 10;
            if (top < scrollTop) top = scrollTop;
          }
        }

        this.popup.style.top = `${top}px`;
        this.popup.style.left = `${left}px`;

        // Initialize with input value or current date
        this.selectedDate = this.input.value
          ? new Date(this.input.value.replace(' ', 'T'))
          : new Date();

        this.viewYear = this.selectedDate.getFullYear();
        this.viewMonth = this.selectedDate.getMonth();

        if (this.hour) this.hour.value = this.selectedDate.getHours();
        if (this.minute) this.minute.value = this.selectedDate.getMinutes();
        if (this.second) this.second.value = this.selectedDate.getSeconds();

        this.updateTimeDisplay();
        this.renderCalendar();
      }

      closePopup() {
        this.popup.style.display = 'none';
        this.removeMonthYearPicker();
      }

      toggleMonthYearPicker() {
        const existing = this.popup.querySelector('.month-year-picker');
        if (existing) {
          existing.remove();
          return;
        }

        const div = document.createElement('div');
        div.className = 'month-year-picker';
        div.style.marginTop = '8px';

        const selectYear = document.createElement('select');
        const currentYear = new Date().getFullYear();
        for (let y = currentYear - 100; y <= currentYear + 100; y++) {
          const opt = document.createElement('option'); 2025
          opt.value = y;
          opt.textContent = y;
          selectYear.appendChild(opt);
        }
        selectYear.value = this.viewYear;
        selectYear.addEventListener('change', () => {
          this.viewYear = parseInt(selectYear.value, 10);
          this.renderCalendar();
        });

        const selectMonth = document.createElement('select');
        for (let m = 0; m < 12; m++) {
          const opt = document.createElement('option');
          opt.value = m;
          opt.textContent = new Date(2020, m, 1).toLocaleString('default', { month: 'long' });
          selectMonth.appendChild(opt);
        }
        selectMonth.value = this.viewMonth;
        selectMonth.addEventListener('change', () => {
          this.viewMonth = parseInt(selectMonth.value, 10);
          this.renderCalendar();
        });

        div.appendChild(selectYear);
        div.appendChild(selectMonth);
        const header = this.popup.querySelector('.calendar-header');
        if (header) {
          header.insertAdjacentElement('afterend', div);
        } else {
          this.popup.appendChild(div); // fallback if header not found
        }

      }

      removeMonthYearPicker() {
        const picker = this.popup.querySelector('.month-year-picker');
        if (picker) picker.remove();
      }
    }

    // Initialize pickers
    document.addEventListener('DOMContentLoaded', () => {
      new DateTimePicker('input[input-type="date"]');
      new DateTimePicker('input[input-type="dateTime"]');
      console.log('DateTimePicker initialized');
    });


  </script>

</body>

</html>